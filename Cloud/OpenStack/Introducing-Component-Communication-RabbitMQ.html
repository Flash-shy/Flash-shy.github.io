<!DOCTYPE html><html lang="en-GB" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>OpenStack Series Chapter5: Introducing Component Communiation---RabbitMQ | Haoyang Sun's Blog</title><meta name="author" content="Haoyang Sun"><meta name="copyright" content="Haoyang Sun"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Let&#39;s discuss RabbitMQ, a message broker that can be used to communicate between different components in an OpenStack environment.">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenStack Series Chapter5: Introducing Component Communiation---RabbitMQ">
<meta property="og:url" content="https://www.sunhaoyang.net/Cloud/OpenStack/Introducing-Component-Communication-RabbitMQ.html">
<meta property="og:site_name" content="Haoyang Sun&#39;s Blog">
<meta property="og:description" content="Let&#39;s discuss RabbitMQ, a message broker that can be used to communicate between different components in an OpenStack environment.">
<meta property="og:locale" content="en_GB">
<meta property="og:image" content="https://blog.sunhaoyang.net/images/OpenStack.png">
<meta property="article:published_time" content="2025-05-09T07:55:04.000Z">
<meta property="article:modified_time" content="2025-05-15T11:34:10.714Z">
<meta property="article:author" content="Haoyang Sun">
<meta property="article:tag" content="OpenStack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.sunhaoyang.net/images/OpenStack.png"><link rel="shortcut icon" href="https://blog.sunhaoyang.net/images/favicon.ico"><link rel="canonical" href="https://www.sunhaoyang.net/Cloud/OpenStack/Introducing-Component-Communication-RabbitMQ.html"><link rel="preconnect"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')
          
          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: '/pluginsSrc/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'OpenStack Series Chapter5: Introducing Component Communiation---RabbitMQ',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://blog.sunhaoyang.net/images/myphoto.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Homepage</span></a></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fa fa-comment-alt"></i><span> Artitalk</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa-solid fa-user"></i><span> About the author</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Haoyang Sun's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">OpenStack Series Chapter5: Introducing Component Communiation---RabbitMQ</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Homepage</span></a></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fa fa-comment-alt"></i><span> Artitalk</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa-solid fa-user"></i><span> About the author</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">OpenStack Series Chapter5: Introducing Component Communiation---RabbitMQ</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-05-09T07:55:04.000Z" title="Created 2025-05-09 15:55:04">2025-05-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-05-15T11:34:10.714Z" title="Updated 2025-05-15 19:34:10">2025-05-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Cloud/">Cloud</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">2.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>17mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">Comments:</span><a href="/Cloud/OpenStack/Introducing-Component-Communication-RabbitMQ.html#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div><article class="container post-content" id="article-container"><h2 id="Introduction-and-Overview-of-RabbitMQ"><a href="#Introduction-and-Overview-of-RabbitMQ" class="headerlink" title="Introduction and Overview of RabbitMQ"></a>Introduction and Overview of RabbitMQ</h2><p>As we discussed before in the last Chapter, OpenStack is highly <code>modular—each</code> function (like Nova, Neutron, Cinder, etc.) operates as an independent service.</p>
<p>All services depend on two back end functions:</p>
<ul>
<li><p>Database (MariaDB)</p>
<p>Database is used to store the persistent data of each OpenStack component.</p>
</li>
<li><p>Message Broker (RabbitMQ)</p>
<p>Message Broker is used to support the communication between each component. Any message broker if only supports <code>AMQP</code>(Advanced Message Queueing Protocol) protocol could be used as a back end.</p>
<p>In OpenStack here, we use <code>RabbitMQ</code> as the message broker.</p>
</li>
</ul>
<h2 id="Some-common-RabbitMQ-terms-and-definitions"><a href="#Some-common-RabbitMQ-terms-and-definitions" class="headerlink" title="Some common RabbitMQ terms and definitions"></a>Some common RabbitMQ terms and definitions</h2><table>
<thead>
<tr>
<th>Term</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Binding</strong></td>
<td>The key or filter parameter used to route from an exchange to a queue.</td>
</tr>
<tr>
<td><strong>Consumer</strong></td>
<td>An application that uses the received messages.</td>
</tr>
<tr>
<td><strong>Exchange</strong></td>
<td>Routes producer-published messages to queues using message metadata.</td>
</tr>
<tr>
<td><strong>Publisher&#x2F;Producer</strong></td>
<td>Applications that publish messages.</td>
</tr>
<tr>
<td><strong>Queue</strong></td>
<td>Stores messages until consumed by an application.</td>
</tr>
<tr>
<td><strong>Routing key</strong></td>
<td>Producer-specified message metadata used by the exchange for message routing.</td>
</tr>
<tr>
<td><strong>Vhost</strong></td>
<td>A logical division of a RabbitMQ instance, used to segregate applications, queues, and exchanges.</td>
</tr>
</tbody></table>
<ul>
<li><p>Binding</p>
<p><code>Binding</code> determines the connection between the <code>queue</code> and the <code>exchange</code>.</p>
</li>
<li><p>Consumer</p>
<p><code>Consumer</code> is the application or server side to receive messages, here in OpenStack, it represents those service components.</p>
</li>
<li><p>Exchange</p>
<p><code>Exchange</code> is like an <code>allocation center</code>. Based on <code>Binding</code> the rule, it will route the message to the corresponding queue.(routing key matches the binding key)</p>
</li>
<li><p>Publisher&#x2F;Produce</p>
<p><code>Publisher/Produce</code> is the application or client side to send messages, here in OpenStack, it represents those service components.</p>
</li>
<li><p>Queue</p>
<p><code>Queue</code> is a temporary space to storage the request messages, until customers fetch messages here.</p>
</li>
<li><p>Routing Key</p>
<p><code>Routing Key</code> is the information produce send with the message, for specifying the destination, the matched queue that the message should be routed to.(routing key matches the binding key)</p>
</li>
<li><p>Vhost</p>
<p><code>Vhost</code> provides the <code>isolated</code> environment for each project, it just likes a <code>namespace</code>.</p>
</li>
</ul>
<h2 id="RabbitMQ-Message-Broker-Exchange-Concepts"><a href="#RabbitMQ-Message-Broker-Exchange-Concepts" class="headerlink" title="RabbitMQ Message Broker Exchange Concepts"></a>RabbitMQ Message Broker Exchange Concepts</h2><p>The exchange’s interaction with a queue is based on the match between the <code>routing key included in the message</code> and the <code>binding key associated with the queue</code> on the related exchange.</p>
<p>This is called the <code>Binding</code> rule.</p>
<p>Different kinds of exchange determine the match mode of <code>routing key</code> and <code>binding key</code>.</p>
<h2 id="Messaging-Patterns-in-RabbitMQ"><a href="#Messaging-Patterns-in-RabbitMQ" class="headerlink" title="Messaging Patterns in RabbitMQ"></a>Messaging Patterns in RabbitMQ</h2><blockquote>
<p><code>Exchange</code>, <code>Binding</code> and <code>Queue</code> are combined in patterns.</p>
</blockquote>
<table>
<thead>
<tr>
<th>Pattern Name</th>
<th>Description</th>
<th>One-to-Many</th>
<th>Callback</th>
</tr>
</thead>
<tbody><tr>
<td>Work Queue</td>
<td>A single queue with multiple consumers, messages are distributed in round-robin</td>
<td>❌</td>
<td>❌</td>
</tr>
<tr>
<td>Pub&#x2F;Sub</td>
<td>Each consumer has its own queue and receives all messages</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>Routing</td>
<td>Exact match on routing key</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>Topic</td>
<td>Fuzzy match on routing key (wildcards allowed)</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>Header</td>
<td>Routing based on headers</td>
<td>✅</td>
<td>❌</td>
</tr>
<tr>
<td>RPC</td>
<td>Request and response messaging (Remote Procedure Call)</td>
<td>❌ (point-to-point)</td>
<td>✅</td>
</tr>
</tbody></table>
<h3 id="1-Publish-Subscribe"><a href="#1-Publish-Subscribe" class="headerlink" title="1. Publish&#x2F;Subscribe"></a>1. Publish&#x2F;Subscribe</h3><p>Multiple consumers receive the same message.</p>
<p><strong>Characteristics:</strong></p>
<ul>
<li>Uses a <code>fanout</code> exchange</li>
<li>Messages are broadcast to all bound queues</li>
<li>Each consumer has its own queue, isolated from others</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Broadcasting notifications</li>
<li>Log collection</li>
<li>Multiple subsystems responding to events simultaneously</li>
</ul>
<hr>
<h3 id="2-Routing"><a href="#2-Routing" class="headerlink" title="2. Routing"></a>2. Routing</h3><p>Messages are delivered based on an exact match of the routing key.</p>
<p><strong>Characteristics:</strong></p>
<ul>
<li>Uses a <code>direct</code> exchange</li>
<li>Queues are bound with binding keys that exactly match routing keys</li>
<li>Multiple queues can be bound with different keys</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Processing different types of tasks in multiple modules</li>
<li>Log levels separation (e.g., error, info, debug)</li>
</ul>
<hr>
<h3 id="3-Topic"><a href="#3-Topic" class="headerlink" title="3. Topic"></a>3. Topic</h3><p>Routing key supports pattern matching with wildcards.</p>
<p><strong>Characteristics:</strong></p>
<ul>
<li>Uses a <code>topic</code> exchange</li>
<li>Supports wildcards <code>*</code> and <code>#</code></li>
<li>More flexible and complex routing logic</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Microservices event bus</li>
<li>Logging systems with hierarchical logs like <code>logs.system.error</code>, <code>logs.user.info</code></li>
</ul>
<hr>
<h3 id="4-Header"><a href="#4-Header" class="headerlink" title="4. Header"></a>4. Header</h3><p>Routing based on message header attributes.</p>
<p><strong>Characteristics:</strong></p>
<ul>
<li>Uses a <code>headers</code> exchange</li>
<li>Does not use routing keys, but matches based on header attributes</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Advanced routing policies</li>
<li>Attribute-driven message delivery (e.g., region&#x3D;us, format&#x3D;json)</li>
</ul>
<hr>
<h3 id="5-Work-Queue"><a href="#5-Work-Queue" class="headerlink" title="5. Work Queue"></a>5. Work Queue</h3><p>Multiple consumers share a single queue, and each message is delivered to only one consumer.</p>
<p>Produce sends the message with the routing key to the <code>exchange</code> (only specify the exchange name), then the exchange will based on its types to determine which queue shoud be routed to. Then, customers subscribe the queue to receive the message from produce.</p>
<p>Many customers subscribe the same queue, even if there is no exchange, queues could aslo hand out work to different multiple customers. The work queue distributes requests in chronological order and follow the rule <strong>FIFO</strong>(first in first out) in the <code>round-robin</code> way.</p>
<p><img src="/../images/work_queue.png" alt="work queue"></p>
<p><strong>Characteristics:</strong></p>
<ul>
<li>Typically uses a <code>direct or default</code> exchange</li>
<li>Multiple consumers compete for messages from the same queue</li>
<li>Enables load balancing (the idle consumer takes the message)</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Background task processing</li>
<li>Batch jobs</li>
<li>Data import, etc.</li>
</ul>
<hr>
<h3 id="6-RPC-Remote-Procedure-Call"><a href="#6-RPC-Remote-Procedure-Call" class="headerlink" title="6. RPC (Remote Procedure Call)"></a>6. RPC (Remote Procedure Call)</h3><p>Client sends a request, server processes it and replies back (pseudo-synchronous).</p>
<p><strong>Characteristics:</strong></p>
<ul>
<li>Uses a <code>direct</code> exchange for the <code>callback</code> and <code>topic</code> exchange for sending</li>
<li>Messages contain <code>reply_to</code> and <code>correlation_id</code> properties</li>
<li>Responses are sent back to a specified temporary queue</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>RPC calls between OpenStack components</li>
<li>Asynchronous task tracking in Celery</li>
</ul>
<p><img src="/../images/RPC.png" alt="RPC"></p>
<ul>
<li>reply_to</li>
</ul>
<p><strong>What is <code>reply_to</code>?</strong></p>
<p><strong>Meaning:</strong> It tells the server “after processing, send the result to which queue”.</p>
<p><strong>Type:</strong> A string representing the name of the callback queue (reply queue).</p>
<p><strong>Purpose:</strong> Allows the client to receive the response message.</p>
<p><strong>Analogy:</strong> It’s like sending a parcel and writing “please send the result back to my office address” — this address is the <code>reply_to</code>.</p>
<ul>
<li>correlation_id</li>
</ul>
<p><strong>What is <code>correlation_id</code>?</strong></p>
<p><strong>Meaning:</strong> A unique identifier (ID) that establishes the correspondence between request and response.</p>
<p><strong>Type:</strong> Usually a UUID or any unique string.</p>
<p><strong>Purpose:</strong> When the client sends multiple requests, it can use the <code>correlation_id</code> to identify which response corresponds to which request.</p>
<p><strong>Analogy:</strong> You send multiple questions (letters), each labelled “Question 1”, “Question 2”, etc. The reply includes the same label, so you know which answer matches which question.</p>
<h2 id="Exchanges"><a href="#Exchanges" class="headerlink" title="Exchanges"></a>Exchanges</h2><h3 id="Direct"><a href="#Direct" class="headerlink" title="Direct"></a>Direct</h3><p><strong>Direct Exchange</strong>: The routing keys are matched against a simple string, like “sales.*“. This means that any message with an exact binding key will be routed to this queue (and vice versa). “Direct” exchange type is used when you want messages sent directly from one application&#x2F;service into another.</p>
<p>In other words, the routing key must be <code>the same as</code> the binding key, one-to-one.</p>
<p>E.g. <code>taskC_create</code> message is routed to <code>taskC_queue</code> queue.</p>
<p><img src="/../images/direct.png" alt="direct"></p>
<h3 id="Topic"><a href="#Topic" class="headerlink" title="Topic"></a>Topic</h3><p><strong>Topic Exchange</strong>: This type of exchange functions like a <code>“fuzzy match”</code>. The routing key of a message and the binding key of a queue can <code>include wildcards (* and #)</code>, allowing for more flexible matching. The <code>*</code> wildcard matches <code>a single word</code>, while <code>#</code> matches <code>multiple words</code>.</p>
<p>E.g. A message can be delivered to one or more queues at the same time. Only <code>compute tasks</code> are routed to the queue named <code>compute_tasks</code>, while <code>all tasks</code>, including compute ones, are routed to the queue named <code>all_tasks</code>.</p>
<p><img src="/../images/topic.png" alt="topic"></p>
<h3 id="Fanout"><a href="#Fanout" class="headerlink" title="Fanout"></a>Fanout</h3><p><strong>Fanout Exchange</strong>: It is like a <code>“broadcast”</code>. It sends messages to <code>all bound queues</code>, <code>regardless of the routing key</code>. Simply put, “if it’s bound, it gets the message”. For example, in a logging system, all queues bound to the exchange will receive the message.</p>
<h3 id="Headers"><a href="#Headers" class="headerlink" title="Headers"></a>Headers</h3><p><strong>Headers</strong>: This exchange type makes use of the message headers to perform the match against the binding arguments of the queue. This is similar to a topic exchange except that there can be multiple key-value headers, and the queue can be matched against any or all. And headers <code>ignore the routing key</code> at all.</p>
<h2 id="Rabbitmq-common-command"><a href="#Rabbitmq-common-command" class="headerlink" title="Rabbitmq common command"></a>Rabbitmq common command</h2><h3 id="Check-the-report-summary"><a href="#Check-the-report-summary" class="headerlink" title="Check the report summary"></a>Check the report summary</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">()[root@controller0 /]# rabbitmqctl report</span><br><span class="line">Reporting server status of node rabbit@controller0 ...</span><br><span class="line"></span><br><span class="line">Status of node rabbit@controller0 ...</span><br><span class="line">[&#123;pid,701&#125;,</span><br><span class="line"> &#123;running_applications,</span><br><span class="line">     [&#123;rabbitmq_management,&quot;RabbitMQ Management Console&quot;,&quot;3.7.23&quot;&#125;,</span><br><span class="line">      &#123;rabbitmq_web_dispatch,&quot;RabbitMQ Web Dispatcher&quot;,&quot;3.7.23&quot;&#125;,</span><br><span class="line">      &#123;amqp_client,&quot;RabbitMQ AMQP Client&quot;,&quot;3.7.23&quot;&#125;,</span><br><span class="line">      &#123;rabbitmq_management_agent,&quot;RabbitMQ Management Agent&quot;,&quot;3.7.23&quot;&#125;,</span><br><span class="line">      &#123;rabbit,&quot;RabbitMQ&quot;,&quot;3.7.23&quot;&#125;,</span><br><span class="line">      &#123;mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.15.6&quot;&#125;,</span><br><span class="line">      &#123;rabbit_common,</span><br><span class="line">          &quot;Modules shared by rabbitmq-server and rabbitmq-erlang-client&quot;,</span><br><span class="line">          &quot;3.7.23&quot;&#125;,</span><br><span class="line">...output omitted...</span><br></pre></td></tr></table></figure>

<h3 id="List-users"><a href="#List-users" class="headerlink" title="List users"></a>List users</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">()[root@controller0 /]# rabbitmqctl list_users</span><br><span class="line">Listing users ...</span><br><span class="line">user tags</span><br><span class="line">guest [administrator]</span><br></pre></td></tr></table></figure>

<h3 id="Create-users"><a href="#Create-users" class="headerlink" title="Create users"></a>Create users</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">()[root@controller0 /]# rabbitmqctl add_user shy shypassword</span><br><span class="line">Adding user &quot;shy&quot; ...</span><br><span class="line">()[root@controller0 /]# rabbitmqctl list_users</span><br><span class="line">Listing users ...</span><br><span class="line">user tags</span><br><span class="line">shy []</span><br><span class="line">guest [administrator]</span><br></pre></td></tr></table></figure>

<h3 id="Allocate-the-permission"><a href="#Allocate-the-permission" class="headerlink" title="Allocate the permission"></a>Allocate the permission</h3><ul>
<li><p>configure: Define the resources that the user could configure.</p>
</li>
<li><p>write: Define the resources that the user could write.</p>
</li>
<li><p>read: Define the resources that the user could read.</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">()[root@controller0 /]# rabbitmqctl set_permissions shy &#x27;.*&#x27; &#x27;.*&#x27; &#x27;.*&#x27;</span><br><span class="line">Setting permissions for user &quot;shy&quot; in vhost &quot;/&quot; ...</span><br><span class="line">()[root@controller0 /]# rabbitmqctl list_permissions</span><br><span class="line">Listing permissions for vhost &quot;/&quot; ...</span><br><span class="line">user configure write read</span><br><span class="line">shy .* .* .*</span><br><span class="line">guest .* .* .*</span><br></pre></td></tr></table></figure>

<h3 id="Add-the-tag-to-users"><a href="#Add-the-tag-to-users" class="headerlink" title="Add the tag to users"></a>Add the tag to users</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">()[root@controller0 /]# rabbitmqctl set_user_tags shy administrator</span><br><span class="line">Setting tags for user &quot;shy&quot; to [administrator] ...</span><br><span class="line">()[root@controller0 /]# rabbitmqctl list_users</span><br><span class="line">Listing users ...</span><br><span class="line">user tags</span><br><span class="line">shy [administrator]</span><br><span class="line">guest [administrator]</span><br></pre></td></tr></table></figure>

<h3 id="List-all-exchanges"><a href="#List-all-exchanges" class="headerlink" title="List all exchanges"></a>List all exchanges</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">()[root@controller0 /]# rabbitmqctl list_exchanges</span><br><span class="line">Listing exchanges for vhost / ...</span><br><span class="line">name type</span><br><span class="line">heat-engine-listener_fanout fanout</span><br><span class="line">manila-share_fanout fanout</span><br><span class="line">engine_fanout fanout</span><br><span class="line">engine_worker_fanout fanout</span><br><span class="line">cinder-volume_fanout fanout</span><br><span class="line">q-server-resource-versions_fanout fanout</span><br><span class="line">openstack topic</span><br><span class="line">amq.rabbitmq.trace topic</span><br><span class="line">amq.fanout fanout</span><br><span class="line">cinder-scheduler_fanout fanout</span><br><span class="line">compute_fanout fanout</span><br><span class="line">amq.match headers</span><br><span class="line">neutron-vo-Port-1.5_fanout fanout</span><br><span class="line">q-plugin_fanout fanout</span><br><span class="line">octavia-rpc_fanout fanout</span><br><span class="line">amq.topic topic</span><br><span class="line">octavia_provisioning_v2_fanout fanout</span><br><span class="line">amq.direct direct</span><br><span class="line">heat topic</span><br><span class="line">amq.headers headers</span><br><span class="line">manila-scheduler_fanout fanout</span><br><span class="line">nova topic</span><br><span class="line">scheduler_fanout fanout</span><br><span class="line">cinder-volume.hostgroup@tripleo_ceph_fanout fanout</span><br><span class="line">conductor_fanout fanout</span><br><span class="line">neutron topic</span><br><span class="line">octavia topic</span><br><span class="line">q-reports-plugin_fanout fanout</span><br><span class="line"> direct</span><br></pre></td></tr></table></figure>

<p>The last one is an <code>implicit direct</code> type exchange.</p>
<p>Its name is an <code>empty</code> string “”.</p>
<p>Every queue is automatically bound to it with a <code>binding key</code> that matches the <code>queue’s name</code>.</p>
<h3 id="List-all-available-queues"><a href="#List-all-available-queues" class="headerlink" title="List all available queues"></a>List all available queues</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">()[root@controller0 /]# rabbitmqctl list_queues</span><br><span class="line">Timeout: 60.0 seconds ...</span><br><span class="line">Listing queues for vhost / ...</span><br><span class="line">name messages</span><br><span class="line">compute.computehci0.overcloud.example.com 0</span><br><span class="line">compute.compute1.overcloud.example.com 0</span><br><span class="line">manila-scheduler.hostgroup 0</span><br><span class="line">engine_worker_fanout_c149d365282c4d7986d35683a679ab43 0</span><br><span class="line">reply_95154a0ef0a7494c91bda27f28a2be56 0</span><br><span class="line">cinder-scheduler 0</span><br><span class="line">q-reports-plugin.controller0.overcloud.example.com 0</span><br><span class="line">scheduler_fanout_76ec3c50ae6447c39559b0311268126b 0</span><br><span class="line">compute.compute0.overcloud.example.com 0</span><br><span class="line">reply_61725f7db23a4e7bacecb41f30be9f72 0</span><br><span class="line">conductor_fanout_49fc039d21894497be4fbfd1ecadcce7 0</span><br><span class="line">octavia-rpc 0</span><br><span class="line">q-server-resource-versions.controller0.overcloud.example.com 0</span><br><span class="line">cinder-volume.hostgroup@tripleo_ceph 0</span><br><span class="line">reply_ccfd22e0f82344bb890ff371a0eaa2f9 0</span><br><span class="line">manila-share_fanout_53d504969d5647319932e92f73bb5773 0</span><br><span class="line">manila-share.hostgroup@cephfs 0</span><br><span class="line">conductor.controller0.overcloud.example.com 0</span><br><span class="line">octavia_provisioning_v2 0</span><br><span class="line">q-reports-plugin 0</span><br><span class="line">heat-engine-listener.34703093-ae25-4a65-80db-203f1ebbad36 0</span><br><span class="line">octavia-rpc.controller0 0</span><br><span class="line">engine_fanout_d9489dad34ab4a2e833e25ba5ac9bd43 0</span><br><span class="line">manila-scheduler_fanout_53141319d79548a3a5a23f472026995c 0</span><br><span class="line">engine 0</span><br><span class="line">q-server-resource-versions 0</span><br><span class="line">scheduler.controller0.overcloud.example.com 0</span><br><span class="line">octavia_provisioning_v2_fanout_516bc8a0d4a04e17b02d7a490ffad7e3 0</span><br><span class="line">q-plugin_fanout_82afdb9f58dd46fd9e12d1b9ff981b57 0</span><br><span class="line">q-plugin.controller0.overcloud.example.com 0</span><br><span class="line">manila-share 0</span><br><span class="line">heat-engine-listener_fanout_092d1af0bf034da0aafbd796ef769ec1 0</span><br><span class="line">compute_fanout_3d54889d98a84dcea09b080c23a255f5 0</span><br><span class="line">cinder-volume 0</span><br><span class="line">engine_worker 0</span><br><span class="line">engine.controller0 0</span><br><span class="line">compute_fanout_ef6b7f891f8b482188a1081436cd99b0 0</span><br><span class="line">engine_worker.34703093-ae25-4a65-80db-203f1ebbad36 0</span><br><span class="line">scheduler_fanout_56d907c013304f0b8ea9ab7ed88b6311 0</span><br><span class="line">compute 0</span><br><span class="line">q-server-resource-versions_fanout_1c237cd6f89549e6873ef5d817441b0f 0</span><br><span class="line">scheduler 0</span><br><span class="line">compute_fanout_d20e7a4456e94533b532e1941594ac6f 0</span><br><span class="line">heat-engine-listener 0</span><br><span class="line">octavia_provisioning_v2.controller0 0</span><br><span class="line">q-reports-plugin_fanout_b04fa13918b749eebcc159bb2520934b 0</span><br><span class="line">cinder-scheduler.controller0 0</span><br><span class="line">cinder-volume_fanout_c4f5af48a98e47f5acda0a01681c16a1 0</span><br><span class="line">octavia-rpc_fanout_a68e626ca08943c986a33ec185f2ad12 0</span><br><span class="line">cinder-volume.hostgroup@tripleo_ceph.hostgroup 0</span><br><span class="line">scheduler_fanout_a19884991bd64a278afed93434054535 0</span><br><span class="line">manila-scheduler 0</span><br><span class="line">cinder-volume.hostgroup@tripleo_ceph_fanout_b7c2b8bbdc494c279d6728ed5fe39f94 0</span><br><span class="line">q-reports-plugin_fanout_3a7fa6f49d9349a0ae6e8143ac075f1f 0</span><br><span class="line">q-plugin 0</span><br><span class="line">conductor 0</span><br><span class="line">cinder-scheduler_fanout_6a11c6037338474a9b3d7ce850b9966a 0</span><br></pre></td></tr></table></figure>

<h3 id="List-all-customers"><a href="#List-all-customers" class="headerlink" title="List all customers"></a>List all customers</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">()[root@controller0 /]# rabbitmqctl list_consumers</span><br><span class="line">Listing consumers in vhost / ...</span><br><span class="line">queue_name channel_pid consumer_tag ack_required prefetch_count arguments</span><br><span class="line">compute.computehci0.overcloud.example.com &lt;rabbit@controller0.3.1232.0&gt; 2 true 0 []</span><br><span class="line">compute.compute1.overcloud.example.com &lt;rabbit@controller0.3.1206.0&gt; 2 true 0 []</span><br><span class="line">manila-scheduler.hostgroup &lt;rabbit@controller0.3.725.0&gt; 2 true 0 []</span><br><span class="line">engine_worker_fanout_c149d365282c4d7986d35683a679ab43 &lt;rabbit@controller0.3.1063.0&gt; 3 true []</span><br><span class="line">reply_95154a0ef0a7494c91bda27f28a2be56 &lt;rabbit@controller0.3.1117.0&gt; 1 true 0 []</span><br><span class="line">cinder-scheduler &lt;rabbit@controller0.3.763.0&gt; 1 true 0 []</span><br><span class="line">q-reports-plugin.controller0.overcloud.example.com &lt;rabbit@controller0.3.1624.0&gt; 2 true []</span><br><span class="line">q-reports-plugin.controller0.overcloud.example.com &lt;rabbit@controller0.3.1509.0&gt; 2 true []</span><br><span class="line">scheduler_fanout_76ec3c50ae6447c39559b0311268126b &lt;rabbit@controller0.3.1165.0&gt; 3 true []</span><br><span class="line">compute.compute0.overcloud.example.com &lt;rabbit@controller0.3.953.0&gt; 2 true 0 []</span><br><span class="line">reply_61725f7db23a4e7bacecb41f30be9f72 &lt;rabbit@controller0.3.802.0&gt; 1 true 0 []</span><br><span class="line">conductor_fanout_49fc039d21894497be4fbfd1ecadcce7 &lt;rabbit@controller0.3.829.0&gt; 3 true []</span><br><span class="line">octavia-rpc &lt;rabbit@controller0.3.980.0&gt; 1 true 0 []</span><br><span class="line">q-server-resource-versions.controller0.overcloud.example.com &lt;rabbit@controller0.3.1585.0&gt; 2 true 0 []</span><br><span class="line">cinder-volume.hostgroup@tripleo_ceph &lt;rabbit@controller0.3.930.0&gt; 1 true 0 []</span><br><span class="line">cinder-volume.hostgroup@tripleo_ceph &lt;rabbit@controller0.3.904.0&gt; 2 true 0 []</span><br><span class="line">reply_ccfd22e0f82344bb890ff371a0eaa2f9 &lt;rabbit@controller0.3.856.0&gt; 1 true 0 []</span><br><span class="line">manila-share_fanout_53d504969d5647319932e92f73bb5773 &lt;rabbit@controller0.3.696.0&gt; 3 true []</span><br><span class="line">manila-share.hostgroup@cephfs &lt;rabbit@controller0.3.696.0&gt; 2 true 0 []</span><br><span class="line">conductor.controller0.overcloud.example.com &lt;rabbit@controller0.3.829.0&gt; 2 true 0 []</span><br><span class="line">octavia_provisioning_v2 &lt;rabbit@controller0.3.1008.0&gt; 1 true 0 []</span><br><span class="line">q-reports-plugin &lt;rabbit@controller0.3.1624.0&gt; 1 true 0 []</span><br><span class="line">q-reports-plugin &lt;rabbit@controller0.3.1509.0&gt; 1 true 0 []</span><br><span class="line">heat-engine-listener.34703093-ae25-4a65-80db-203f1ebbad36 &lt;rabbit@controller0.3.1035.0&gt; 2 true 0 []</span><br><span class="line">octavia-rpc.controller0 &lt;rabbit@controller0.3.980.0&gt; 2 true 0 []</span><br><span class="line">engine_fanout_d9489dad34ab4a2e833e25ba5ac9bd43 &lt;rabbit@controller0.3.1090.0&gt; 3 true 0 []</span><br><span class="line">manila-scheduler_fanout_53141319d79548a3a5a23f472026995c &lt;rabbit@controller0.3.725.0&gt; 3 true 0 []</span><br><span class="line">engine &lt;rabbit@controller0.3.1090.0&gt; 1 true 0 []</span><br><span class="line">q-server-resource-versions &lt;rabbit@controller0.3.1585.0&gt; 1 true 0 []</span><br><span class="line">scheduler.controller0.overcloud.example.com &lt;rabbit@controller0.3.1164.0&gt; 2 true 0 []</span><br><span class="line">scheduler.controller0.overcloud.example.com &lt;rabbit@controller0.3.1165.0&gt; 2 true 0 []</span><br><span class="line">scheduler.controller0.overcloud.example.com &lt;rabbit@controller0.3.1149.0&gt; 2 true 0 []</span><br><span class="line">octavia_provisioning_v2_fanout_516bc8a0d4a04e17b02d7a490ffad7e3 &lt;rabbit@controller0.3.1008.0&gt; 3 true 0 []</span><br><span class="line">q-plugin_fanout_82afdb9f58dd46fd9e12d1b9ff981b57 &lt;rabbit@controller0.3.1517.0&gt; 3 true []</span><br><span class="line">q-plugin.controller0.overcloud.example.com &lt;rabbit@controller0.3.1517.0&gt; 2 true 0 []</span><br><span class="line">manila-share &lt;rabbit@controller0.3.696.0&gt; 1 true 0 []</span><br><span class="line">heat-engine-listener_fanout_092d1af0bf034da0aafbd796ef769ec1 &lt;rabbit@controller0.3.1035.0&gt; 3 true 0 []</span><br><span class="line">compute_fanout_3d54889d98a84dcea09b080c23a255f5 &lt;rabbit@controller0.3.1232.0&gt; 3 true 0 []</span><br><span class="line">cinder-volume &lt;rabbit@controller0.3.904.0&gt; 1 true 0 []</span><br><span class="line">engine_worker &lt;rabbit@controller0.3.1063.0&gt; 1 true 0 []</span><br><span class="line">engine.controller0 &lt;rabbit@controller0.3.1090.0&gt; 2 true 0 []</span><br><span class="line">compute_fanout_ef6b7f891f8b482188a1081436cd99b0 &lt;rabbit@controller0.3.1206.0&gt; 3 true 0 []</span><br><span class="line">engine_worker.34703093-ae25-4a65-80db-203f1ebbad36 &lt;rabbit@controller0.3.1063.0&gt; 2 true []</span><br><span class="line">scheduler_fanout_56d907c013304f0b8ea9ab7ed88b6311 &lt;rabbit@controller0.3.1149.0&gt; 3 true []</span><br><span class="line">compute &lt;rabbit@controller0.3.1232.0&gt; 1 true 0 []</span><br><span class="line">compute &lt;rabbit@controller0.3.1206.0&gt; 1 true 0 []</span><br><span class="line">compute &lt;rabbit@controller0.3.953.0&gt; 1 true 0 []</span><br><span class="line">q-server-resource-versions_fanout_1c237cd6f89549e6873ef5d817441b0f &lt;rabbit@controller0.3.1585.0&gt; true 0 []</span><br><span class="line">scheduler &lt;rabbit@controller0.3.1165.0&gt; 1 true 0 []</span><br><span class="line">scheduler &lt;rabbit@controller0.3.1164.0&gt; 1 true 0 []</span><br><span class="line">scheduler &lt;rabbit@controller0.3.1149.0&gt; 1 true 0 []</span><br><span class="line">compute_fanout_d20e7a4456e94533b532e1941594ac6f &lt;rabbit@controller0.3.953.0&gt; 3 true 0 []</span><br><span class="line">heat-engine-listener &lt;rabbit@controller0.3.1035.0&gt; 1 true 0 []</span><br><span class="line">octavia_provisioning_v2.controller0 &lt;rabbit@controller0.3.1008.0&gt; 2 true 0 []</span><br><span class="line">q-reports-plugin_fanout_b04fa13918b749eebcc159bb2520934b &lt;rabbit@controller0.3.1624.0&gt; 3 true 0 []</span><br><span class="line">cinder-scheduler.controller0 &lt;rabbit@controller0.3.763.0&gt; 2 true 0 []</span><br><span class="line">cinder-volume_fanout_c4f5af48a98e47f5acda0a01681c16a1 &lt;rabbit@controller0.3.904.0&gt; 3 true []</span><br><span class="line">octavia-rpc_fanout_a68e626ca08943c986a33ec185f2ad12 &lt;rabbit@controller0.3.980.0&gt; 3 true []</span><br><span class="line">cinder-volume.hostgroup@tripleo_ceph.hostgroup &lt;rabbit@controller0.3.930.0&gt; 2 true 0 []</span><br><span class="line">scheduler_fanout_a19884991bd64a278afed93434054535 &lt;rabbit@controller0.3.1164.0&gt; 3 true []</span><br><span class="line">manila-scheduler &lt;rabbit@controller0.3.725.0&gt; 1 true 0 []</span><br><span class="line">cinder-volume.hostgroup@tripleo_ceph_fanout_b7c2b8bbdc494c279d6728ed5fe39f94 &lt;rabbit@controller0.3.930.0&gt; 3 true 0 []</span><br><span class="line">q-reports-plugin_fanout_3a7fa6f49d9349a0ae6e8143ac075f1f &lt;rabbit@controller0.3.1509.0&gt; 3 true 0 []</span><br><span class="line">q-plugin &lt;rabbit@controller0.3.1517.0&gt; 1 true 0 []</span><br><span class="line">conductor &lt;rabbit@controller0.3.829.0&gt; 1 true 0 []</span><br><span class="line">cinder-scheduler_fanout_6a11c6037338474a9b3d7ce850b9966a &lt;rabbit@controller0.3.763.0&gt; 3 true 0 []</span><br></pre></td></tr></table></figure>

<h3 id="Trace-on-the-RabbitMQ-message"><a href="#Trace-on-the-RabbitMQ-message" class="headerlink" title="Trace on the RabbitMQ message"></a>Trace on the RabbitMQ message</h3><p>This feature can be used to track all messages flowing through the system, whether incoming or outgoing. In other words, it acts like a supervisor, logging every message in motion. This capability is based on the <code>firehose</code> mechanism.</p>
<p>The name firehose comes from its function—it behaves like a firehose, <code>spraying out</code> all messages so you can see each one passing through. This feature is very useful during development and debugging, but as it records all messages, it may impact performance.</p>
<h4 id="Enable-the-trace"><a href="#Enable-the-trace" class="headerlink" title="Enable the trace"></a>Enable the trace</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl trace_on</span><br></pre></td></tr></table></figure>

<p>Once enabled, all messages entering the RabbitMQ system are copied to a special exchange called <code>amq.rabbitmq.trace</code>. This allows you to observe the entire message flow within that exchange, which is particularly useful for <code>debugging and monitoring</code>.</p>
<blockquote>
<p><strong>Performance impact</strong>: Enabling the Firehose Tracer <code>increases system load</code>, as it must handle and replicate every message. Therefore, it is recommended to enable it only when debugging is necessary, and to <code>disable it promptly once debugging is complete</code>.</p>
<p><strong>Monitoring amq.rabbitmq.trace</strong>: After enabling tracing, you can monitor system activity by inspecting the messages in the <code>amq.rabbitmq.trace exchange</code>. This exchange contains copies of all messages, making it easier to analyse system behaviour.</p>
</blockquote>
<h4 id="Disable-the-trace"><a href="#Disable-the-trace" class="headerlink" title="Disable the trace"></a>Disable the trace</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl trace_off</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://www.sunhaoyang.net">Haoyang Sun</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://www.sunhaoyang.net/Cloud/OpenStack/Introducing-Component-Communication-RabbitMQ.html">https://www.sunhaoyang.net/Cloud/OpenStack/Introducing-Component-Communication-RabbitMQ.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">This article is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License. Please attribute the original author and source when sharing.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/OpenStack/">OpenStack</a></div><div class="post-share"><div class="social-share" data-image="https://blog.sunhaoyang.net/images/OpenStack.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="/pluginsSrc/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>Buy Me a Coffee</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://blog.sunhaoyang.net/images/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="https://blog.sunhaoyang.net/images/wechat.jpg" alt="Wechat"/></a><div class="post-qr-code-desc">Wechat</div></li><li class="reward-item"><a href="https://blog.sunhaoyang.net/images/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="https://blog.sunhaoyang.net/images/alipay.jpg" alt="Alipay"/></a><div class="post-qr-code-desc">Alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/Cloud/OpenStack/Identifying-shared-services-and-VNC/index.html" title="OpenStack Series Chapter4: Identifying shared services and VNC"><img class="cover" src="https://blog.sunhaoyang.net/images/OpenStack.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">OpenStack Series Chapter4: Identifying shared services and VNC</div></div><div class="info-2"><div class="info-item-1">This article mainly introduces the shared services running on the controller node and the process of VNC.</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/Cloud/OpenStack/Identifying-shared-services-and-VNC/index.html" title="OpenStack Series Chapter4: Identifying shared services and VNC"><img class="cover" src="https://blog.sunhaoyang.net/images/OpenStack.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-07</div><div class="info-item-2">OpenStack Series Chapter4: Identifying shared services and VNC</div></div><div class="info-2"><div class="info-item-1">This article mainly introduces the shared services running on the controller node and the process of VNC.</div></div></div></a><a class="pagination-related" href="/Cloud/OpenStack/Openstack-Deployment-Overview/index.html" title="Openstack Deployment Series Chapter0:Overview"><img class="cover" src="https://blog.sunhaoyang.net/images/OpenStack.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-06</div><div class="info-item-2">Openstack Deployment Series Chapter0:Overview</div></div><div class="info-2"><div class="info-item-1">This deployment uses a fully manual approach, with the aim of helping everyone understand the deployment details and how the components work together.</div></div></div></a><a class="pagination-related" href="/Cloud/OpenStack/Introducing-Overcloud/index.html" title="OpenStack Series Chapter3:Introducing Overcloud"><img class="cover" src="https://blog.sunhaoyang.net/images/OpenStack.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-06</div><div class="info-item-2">OpenStack Series Chapter3:Introducing Overcloud</div></div><div class="info-2"><div class="info-item-1">Similarly, Let's understand the core Red Hat OpenStack components, manage overcloud services, and view the overcloud structure in this Chapter.</div></div></div></a><a class="pagination-related" href="/Cloud/OpenStack/Introducing-Undercloud/index.html" title="OpenStack Series Chapter2:Introducing Undercloud"><img class="cover" src="https://blog.sunhaoyang.net/images/OpenStack.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-30</div><div class="info-item-2">OpenStack Series Chapter2:Introducing Undercloud</div></div><div class="info-2"><div class="info-item-1">Let's understand the core Red Hat OpenStack components, manage undercloud services, and view the undercloud structure in this Chapter.</div></div></div></a><a class="pagination-related" href="/Cloud/OpenStack/Introducing-Containerized-Services/index.html" title="OpenStack Series Chapter1:Introducing Containerized Services"><img class="cover" src="https://blog.sunhaoyang.net/images/OpenStack.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-29</div><div class="info-item-2">OpenStack Series Chapter1:Introducing Containerized Services</div></div><div class="info-2"><div class="info-item-1">This article provides a detailed introduction to how the main services of OpenStack run in containers through TripleO. It covers the relevant container commands in detail, as well as how to manage container services using systemd.</div></div></div></a><a class="pagination-related" href="/Cloud/OpenStack/Creating-and-Deleting-VMs-instaces(2)/index.html" title="OpenStack Series Chapter0: Creating and Deleting VMs instaces(2)"><img class="cover" src="https://blog.sunhaoyang.net/images/OpenStack.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-14</div><div class="info-item-2">OpenStack Series Chapter0: Creating and Deleting VMs instaces(2)</div></div><div class="info-2"><div class="info-item-1">This article mainly introduces how to create and delete the VMs instance in openstack by using CLI in terminal.</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://blog.sunhaoyang.net/images/myphoto.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Haoyang Sun</div><div class="author-info-description">DevOps Engineer, Cloud-native Engineer, Open-source technology enthusiast</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content"><div class="center-content" style="text-align: center;">
    <p>My blog is now live!</p>
    <p>Hello everyone! Thank you for visiting my blog!</p>
    <p>Here, I will share my thoughts and reflections on various technologies and aspects of life.</p>
    <p>Please stay tuned for updates!:)</p>
    <p>If you’re interested in discussing any topic with me, feel free to leave a comment or reach out through the contact information provided below.</p>
    <p>Email: Flash_shy@163.com</p>
    <p>QQ ID: 1135300457</p>
    <p>Wechat ID: Flash_sunhy</p>
</div>
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introduction-and-Overview-of-RabbitMQ"><span class="toc-number">1.</span> <span class="toc-text">Introduction and Overview of RabbitMQ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Some-common-RabbitMQ-terms-and-definitions"><span class="toc-number">2.</span> <span class="toc-text">Some common RabbitMQ terms and definitions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RabbitMQ-Message-Broker-Exchange-Concepts"><span class="toc-number">3.</span> <span class="toc-text">RabbitMQ Message Broker Exchange Concepts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Messaging-Patterns-in-RabbitMQ"><span class="toc-number">4.</span> <span class="toc-text">Messaging Patterns in RabbitMQ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Publish-Subscribe"><span class="toc-number">4.1.</span> <span class="toc-text">1. Publish&#x2F;Subscribe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Routing"><span class="toc-number">4.2.</span> <span class="toc-text">2. Routing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Topic"><span class="toc-number">4.3.</span> <span class="toc-text">3. Topic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Header"><span class="toc-number">4.4.</span> <span class="toc-text">4. Header</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Work-Queue"><span class="toc-number">4.5.</span> <span class="toc-text">5. Work Queue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-RPC-Remote-Procedure-Call"><span class="toc-number">4.6.</span> <span class="toc-text">6. RPC (Remote Procedure Call)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exchanges"><span class="toc-number">5.</span> <span class="toc-text">Exchanges</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Direct"><span class="toc-number">5.1.</span> <span class="toc-text">Direct</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Topic"><span class="toc-number">5.2.</span> <span class="toc-text">Topic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fanout"><span class="toc-number">5.3.</span> <span class="toc-text">Fanout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Headers"><span class="toc-number">5.4.</span> <span class="toc-text">Headers</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rabbitmq-common-command"><span class="toc-number">6.</span> <span class="toc-text">Rabbitmq common command</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Check-the-report-summary"><span class="toc-number">6.1.</span> <span class="toc-text">Check the report summary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#List-users"><span class="toc-number">6.2.</span> <span class="toc-text">List users</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-users"><span class="toc-number">6.3.</span> <span class="toc-text">Create users</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Allocate-the-permission"><span class="toc-number">6.4.</span> <span class="toc-text">Allocate the permission</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Add-the-tag-to-users"><span class="toc-number">6.5.</span> <span class="toc-text">Add the tag to users</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#List-all-exchanges"><span class="toc-number">6.6.</span> <span class="toc-text">List all exchanges</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#List-all-available-queues"><span class="toc-number">6.7.</span> <span class="toc-text">List all available queues</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#List-all-customers"><span class="toc-number">6.8.</span> <span class="toc-text">List all customers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trace-on-the-RabbitMQ-message"><span class="toc-number">6.9.</span> <span class="toc-text">Trace on the RabbitMQ message</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Enable-the-trace"><span class="toc-number">6.9.1.</span> <span class="toc-text">Enable the trace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Disable-the-trace"><span class="toc-number">6.9.2.</span> <span class="toc-text">Disable the trace</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Cloud/OpenStack/Introducing-Component-Communication-RabbitMQ.html" title="OpenStack Series Chapter5: Introducing Component Communiation---RabbitMQ"><img src="https://blog.sunhaoyang.net/images/OpenStack.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OpenStack Series Chapter5: Introducing Component Communiation---RabbitMQ"/></a><div class="content"><a class="title" href="/Cloud/OpenStack/Introducing-Component-Communication-RabbitMQ.html" title="OpenStack Series Chapter5: Introducing Component Communiation---RabbitMQ">OpenStack Series Chapter5: Introducing Component Communiation---RabbitMQ</a><time datetime="2025-05-09T07:55:04.000Z" title="Created 2025-05-09 15:55:04">2025-05-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Cloud/OpenStack/Identifying-shared-services-and-VNC/index.html" title="OpenStack Series Chapter4: Identifying shared services and VNC"><img src="https://blog.sunhaoyang.net/images/OpenStack.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OpenStack Series Chapter4: Identifying shared services and VNC"/></a><div class="content"><a class="title" href="/Cloud/OpenStack/Identifying-shared-services-and-VNC/index.html" title="OpenStack Series Chapter4: Identifying shared services and VNC">OpenStack Series Chapter4: Identifying shared services and VNC</a><time datetime="2025-05-07T09:16:17.000Z" title="Created 2025-05-07 17:16:17">2025-05-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Linux/Mount/cifs-mount-attention/index.html" title="cifs mount attention"><img src="https://blog.sunhaoyang.net/images/Mount.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="cifs mount attention"/></a><div class="content"><a class="title" href="/Linux/Mount/cifs-mount-attention/index.html" title="cifs mount attention">cifs mount attention</a><time datetime="2025-05-07T05:12:46.000Z" title="Created 2025-05-07 13:12:46">2025-05-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Cloud/OpenStack/Openstack-Deployment-Overview/index.html" title="Openstack Deployment Series Chapter0:Overview"><img src="https://blog.sunhaoyang.net/images/OpenStack.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Openstack Deployment Series Chapter0:Overview"/></a><div class="content"><a class="title" href="/Cloud/OpenStack/Openstack-Deployment-Overview/index.html" title="Openstack Deployment Series Chapter0:Overview">Openstack Deployment Series Chapter0:Overview</a><time datetime="2025-05-06T15:25:18.000Z" title="Created 2025-05-06 23:25:18">2025-05-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Cloud/OpenStack/Introducing-Overcloud/index.html" title="OpenStack Series Chapter3:Introducing Overcloud"><img src="https://blog.sunhaoyang.net/images/OpenStack.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OpenStack Series Chapter3:Introducing Overcloud"/></a><div class="content"><a class="title" href="/Cloud/OpenStack/Introducing-Overcloud/index.html" title="OpenStack Series Chapter3:Introducing Overcloud">OpenStack Series Chapter3:Introducing Overcloud</a><time datetime="2025-05-06T12:45:13.000Z" title="Created 2025-05-06 20:45:13">2025-05-06</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://blog.sunhaoyang.net/images/footer_background.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By Haoyang Sun</div><div class="footer_custom_text"><a href="https://beian.mps.gov.cn/#/query/webSearch" target="_blank">
  <img src="https://blog.sunhaoyang.net/images/gonganbeian.png" alt="公安备案" style="vertical-align:middle; width:16px; heigh:16px;"> 辽公网安备21029602001011号
</a>
<a href="https://beian.miit.gov.cn/" rel="noreferrer" target="_blank">
  <img src="https://blog.sunhaoyang.net/images/icpbeian.png" alt="ICP备案" style="vertical-align:middle; width:16px; height:16px;"> 辽ICP备2025048274号-1
</a>
</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.sunhaoyang.net/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo.sunhaoyang.net/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    GLOBAL_CONFIG_SITE.isPost && getCount()

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('/pluginsSrc/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script>window.newestComments = {
  changeContent: content => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[Image]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[Link]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[Code]') // replace code
    content = content.replace(/<code>.*?<\/code>/gi, '[Code]') // replace code      
    content = content.replace(/<[^>]+>/g, "") // remove html tag

    if (content.length > 150) {
      content = content.substring(0, 150) + '...'
    }
    return content
  },

  generateHtml: (array, ele) => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class="aside-list-item">'

        if (true && array[i].avatar) {
          const imgAttr = 'src'
          result += `<a href="${array[i].url}" class="thumbnail"><img ${imgAttr}="${array[i].avatar}" alt="${array[i].nick}"></a>`
        }

        result += `<div class="content">
        <a class="comment" href="${array[i].url}" title="${array[i].content}">${array[i].content}</a>
        <div class="name"><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += 'No comments'
    }

    ele.innerHTML = result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh(ele)
  },

  newestCommentInit: (name, getComment) => {
    const $dom = document.querySelector('#card-newest-comments .aside-list')
    if ($dom) {
      const data = btf.saveToLocal.get(name)
      if (data) {
        newestComments.generateHtml(JSON.parse(data), $dom)
      } else {
        getComment($dom)
      }
    }
  },

  run: (name, getComment) => {
    newestComments.newestCommentInit(name, getComment)
    btf.addGlobalFn('pjaxComplete', () => newestComments.newestCommentInit(name, getComment), name)
  }
}</script><script>window.addEventListener('load', () => {
  const keyName = 'twikoo-newest-comments'
  const { changeContent, generateHtml, run } = window.newestComments

  const getComment = ele => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.sunhaoyang.net/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(res => {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        btf.saveToLocal.set(keyName, JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray, ele)
      }).catch(err => {
        console.error(err)
        ele.textContent= "Unable to retrieve comments, please check the configuration"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      btf.getScript('/pluginsSrc/twikoo/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  run(keyName, getComment)
})</script><div class="aplayer no-destroy" data-id="7613104556" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><script defer="defer" id="fluttering_ribbon" mobile="true" src="/pluginsSrc/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="/pluginsSrc/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="/pluginsSrc/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/aplayer/dist/APlayer.min.js"></script><script src="/pluginsSrc/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="/pluginsSrc/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404.html')
    }
  })
})()</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>