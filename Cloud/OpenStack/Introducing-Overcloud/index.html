<!DOCTYPE html><html lang="en-GB" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>OpenStack Series Chapter3:Introducing Overcloud | Haoyang Sun's Blog</title><meta name="author" content="Haoyang Sun"><meta name="copyright" content="Haoyang Sun"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Similarly, Let&#39;s understand the core Red Hat OpenStack components, manage overcloud services, and view the overcloud structure in this Chapter.">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenStack Series Chapter3:Introducing Overcloud">
<meta property="og:url" content="https://blog.sunhaoyang.net/Cloud/OpenStack/Introducing-Overcloud/index.html">
<meta property="og:site_name" content="Haoyang Sun&#39;s Blog">
<meta property="og:description" content="Similarly, Let&#39;s understand the core Red Hat OpenStack components, manage overcloud services, and view the overcloud structure in this Chapter.">
<meta property="og:locale" content="en_GB">
<meta property="og:image" content="https://blog.sunhaoyang.net/images/OpenStack.png">
<meta property="article:published_time" content="2025-05-06T12:45:13.000Z">
<meta property="article:modified_time" content="2025-05-06T14:21:01.218Z">
<meta property="article:author" content="Haoyang Sun">
<meta property="article:tag" content="OpenStack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.sunhaoyang.net/images/OpenStack.png"><link rel="shortcut icon" href="https://blog.sunhaoyang.net/images/favicon.ico"><link rel="canonical" href="https://blog.sunhaoyang.net/Cloud/OpenStack/Introducing-Overcloud/index.html"><link rel="preconnect"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')
          
          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: '/pluginsSrc/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'OpenStack Series Chapter3:Introducing Overcloud',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://blog.sunhaoyang.net/images/myphoto.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">36</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Homepage</span></a></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fa fa-comment-alt"></i><span> Artitalk</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa-solid fa-user"></i><span> About the author</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Haoyang Sun's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">OpenStack Series Chapter3:Introducing Overcloud</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Homepage</span></a></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fa fa-comment-alt"></i><span> Artitalk</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa-solid fa-user"></i><span> About the author</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">OpenStack Series Chapter3:Introducing Overcloud</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-05-06T12:45:13.000Z" title="Created 2025-05-06 20:45:13">2025-05-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-05-06T14:21:01.218Z" title="Updated 2025-05-06 22:21:01">2025-05-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Cloud/">Cloud</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">2.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>17mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">Comments:</span><a href="/Cloud/OpenStack/Introducing-Overcloud/index.html#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div><article class="container post-content" id="article-container"><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>In Red Hat OpenStack Platform (RHOSP), a Red Hat supported overcloud is built by the undercloud <code>Director</code> node using the Deployment service <code>TripleO</code>. At the same time, the undercloud can deploy and manage <code>multiple</code> overclouds.</p>
<h2 id="The-Deployment-template"><a href="#The-Deployment-template" class="headerlink" title="The Deployment template"></a>The Deployment template</h2><p>An overcloud consists of numerous deployed nodes, each configured using roles, which specify the services and configuration required for a node to perform that role. Predefined RHOSP role definitions are located in the <code>/usr/share/openstack-tripleo-heat-templates/roles</code> directory and can be viewed with the <code>openstack role</code> command.</p>
<h3 id="Check-all-default-roles"><a href="#Check-all-default-roles" class="headerlink" title="Check all default roles"></a>Check all default roles</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(undercloud) [stack@director ~]$ ls /usr/share/openstack-tripleo-heat-templates/roles | wc -l</span><br><span class="line">52</span><br><span class="line"></span><br><span class="line">(undercloud) [stack@director ~]$ ls /usr/share/openstack-tripleo-heat-templates/roles</span><br><span class="line">BlockStorage.yaml           ComputePPC64LE.yaml                 DistributedComputeScaleOut.yaml</span><br><span class="line">CellController.yaml         ComputeRBDEphemeral.yaml            HciCephAll.yaml</span><br><span class="line">CephAll.yaml                ComputeRealTime.yaml                HciCephFile.yaml</span><br><span class="line">CephFile.yaml               ComputeSriov.yaml                   HciCephMon.yaml</span><br><span class="line">CephObject.yaml             ComputeSriovIB.yaml                 HciCephObject.yaml</span><br><span class="line">CephStorage.yaml            ComputeSriovRT.yaml                 IronicConductor.yaml</span><br><span class="line">Compute.yaml                Controller.yaml                     Messaging.yaml</span><br><span class="line">ComputeAlt.yaml             ControllerAllNovaStandalone.yaml    Networker.yaml</span><br><span class="line">ComputeDVR.yaml             ControllerNoCeph.yaml               NetworkerSriov.yaml</span><br><span class="line">ComputeHCI.yaml             ControllerNovaStandalone.yaml       Novacontrol.yaml</span><br><span class="line">ComputeHCIOvsDpdk.yaml      ControllerOpenstack.yaml            ObjectStorage.yaml</span><br><span class="line">ComputeInstanceHA.yaml      ControllerSriov.yaml                README.rst</span><br><span class="line">ComputeLiquidio.yaml        ControllerStorageDashboard.yaml     Standalone.yaml</span><br><span class="line">ComputeLocalEphemeral.yaml  ControllerStorageNfs.yaml           Telemetry.yaml</span><br><span class="line">ComputeOvsDpdk.yaml         Database.yaml                       Undercloud.yaml</span><br><span class="line">ComputeOvsDpdkRT.yaml       DistributedCompute.yaml             UndercloudMinion.yaml</span><br><span class="line">ComputeOvsDpdkSriov.yaml    DistributedComputeHCI.yaml</span><br><span class="line">ComputeOvsDpdkSriovRT.yaml  DistributedComputeHCIScaleOut.yaml</span><br></pre></td></tr></table></figure>

<h3 id="Check-all-deployed-roles"><a href="#Check-all-deployed-roles" class="headerlink" title="Check all deployed roles"></a>Check all deployed roles</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(undercloud) [stack@director ~]$ grep &#x27;^- name:&#x27; ~/templates/roles_data.yaml</span><br><span class="line">- name: Controller</span><br><span class="line">- name: Compute</span><br><span class="line">- name: CephStorage</span><br><span class="line">- name: ComputeHCI</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Controller</p>
<p>Control plane node with all core services loaded. Provides service APIs and handles database, messaging, and network processing functions.</p>
<blockquote>
<p>In the exercise case, we provide only one <code>Controller</code> node.</p>
</blockquote>
</li>
<li><p>Compute</p>
<p>Standard compute node working as a hypervisor running deployed instances and stacks.</p>
</li>
<li><p>CephStorage</p>
<p>Storage back end node using a containerized Red Hat Ceph Storage server and multiple object storage disks (OSDs).</p>
</li>
<li><p>ComputeHCI</p>
<p>Converged node. (<code>Compute node</code> + <code>CephStorage node</code>.)</p>
<p>Compute node with hyperconverged infrastructure, combining compute and Ceph OSD functionality on a single node.</p>
</li>
</ul>
<h2 id="Components-and-Services"><a href="#Components-and-Services" class="headerlink" title="Components and Services"></a>Components and Services</h2><h3 id="Core-Services"><a href="#Core-Services" class="headerlink" title="Core Services"></a>Core Services</h3><ul>
<li><p>Block Storage Service (Cinder)</p>
<p>Cinder -&gt; Ceph.</p>
<p>Original Swift only provides the object storage. So, Cinder will schedule the back-end <code>Ceph</code> for <code>block</code> and <code>file</code> storage.</p>
</li>
<li><p>Image Service (Glance)</p>
<p>The Image service stores and manages images used to deploy instances. (<code>Object Storage</code>)</p>
</li>
<li><p>Orchestration Service (Heat)</p>
<p>In the undercloud, Heat templates deploy each <code>overcloud as a stack</code>.</p>
<p>In the overcloud, Heat templates deploy <code>application workloads as stacks</code>.</p>
<p>All templates are based on <code>yaml</code> files.</p>
</li>
<li><p>Dashboard Service (Horizon)</p>
<p><code>Web UI Front-end Dashboard</code> It just looks like a console. More convenient and intuitionistic.</p>
<p>The Dashboard service provides a browser-based interface for self-service cloud users to create and configure resources and launch and manage instances and stacks.</p>
</li>
<li><p>Identity Service (Keystone)</p>
<p>It looks like a <code>gate-keeper</code> to confirm&#x2F;verify the comer.</p>
<p>The Identity service provides domain, project, and user <code>authorization</code> for other overcloud services.</p>
</li>
<li><p>OpenStack Networking Service (Neutron)</p>
<p>It’s responsible for the network.</p>
<p>The OpenStack Networking service manages <code>virtual networking infrastructure</code>. It provides the virtual network and manages the network interfaces.</p>
</li>
<li><p>Compute Service (Nova)</p>
<p>The Compute service schedules and runs on-demand virtual machines. </p>
<p>It’s responsible for <code>creating, starting, stoping and removing the virtual machines</code>.</p>
</li>
<li><p>Messaging Service (Oslo)</p>
<p>It provides a common <code>messaging framework</code> and provides a compatible and consistent <code>communication</code> feature set between each services.</p>
</li>
<li><p>Object Store (Swift)</p>
<p><code>Original and default</code> object storage back-end.</p>
<p>The Object Store service provides self-service cloud user object storage. Other overcloud services that collect data or objects can use the <code>Object Store</code> service as a back end.</p>
</li>
</ul>
<h3 id="Discretionary-and-Operational-OpenStack-Services"><a href="#Discretionary-and-Operational-OpenStack-Services" class="headerlink" title="Discretionary and Operational OpenStack Services"></a>Discretionary and Operational OpenStack Services</h3><ul>
<li><p>Bare Metal Service (Ironic)</p>
<p><code>Initializes</code> and <code>introspects</code> -&gt; <code>scaling</code>.</p>
<p>The Bare Metal service locates and prepares compute resources, including bare metal and virtual machines.</p>
</li>
<li><p>File Share Service (Manila)</p>
<p>It can use either the <code>NFS</code> or <code>CIFS</code> protocols to provide file sharing to instances. </p>
</li>
<li><p>Load Balancing Service(Octavia)</p>
<p>It is an original <code>HAProxy-based</code> service.<br>The Load Balancing service enables failover network traffic distribution to instances in a multitier application architecture.</p>
</li>
</ul>
<h2 id="Managing-the-Overcloud"><a href="#Managing-the-Overcloud" class="headerlink" title="Managing the Overcloud"></a>Managing the Overcloud</h2><h3 id="Listing-all-Overcloud-nodes"><a href="#Listing-all-Overcloud-nodes" class="headerlink" title="Listing all Overcloud nodes"></a>Listing all Overcloud nodes</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(undercloud) [stack@director ~]$ openstack server list \</span><br><span class="line">&gt; -c &#x27;Name&#x27; -c &#x27;Status&#x27; -c &#x27;Networks&#x27;</span><br><span class="line">+-------------+--------+------------------------+</span><br><span class="line">| Name        | Status | Networks               |</span><br><span class="line">+-------------+--------+------------------------+</span><br><span class="line">| controller0 | ACTIVE | ctlplane=172.25.249.56 |</span><br><span class="line">| computehci0 | ACTIVE | ctlplane=172.25.249.54 |</span><br><span class="line">| compute1    | ACTIVE | ctlplane=172.25.249.53 |</span><br><span class="line">| compute0    | ACTIVE | ctlplane=172.25.249.59 |</span><br><span class="line">| ceph0       | ACTIVE | ctlplane=172.25.249.58 |</span><br><span class="line">+-------------+--------+------------------------+</span><br></pre></td></tr></table></figure>

<h3 id="High-Availability"><a href="#High-Availability" class="headerlink" title="High Availability"></a>High Availability</h3><p>Red Hat OpenStack Platform uses <code>Pacemaker</code> as the cluster resource manager, <code>HAProxy</code> as the load balancing cluster service, and <code>MariaDB Galera</code> as the replicated database service.</p>
<p>RHOSP Director installs a <code>duplicate set</code> of OpenStack components on each controller node and manages them as a single service.</p>
<ul>
<li><p>Pacemaker -&gt; Manager and Scheduler</p>
</li>
<li><p>HAProxy -&gt; Allocate all network traffic.</p>
</li>
<li><p>MariaDB -&gt; Duplicate the data.</p>
</li>
</ul>
<p>We could use the command to check the status of our cluster.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[heat-admin@controller0 ~]$ sudo pcs status</span><br><span class="line">Cluster name: tripleo_cluster</span><br><span class="line">Cluster Summary:</span><br><span class="line">  * Stack: corosync</span><br><span class="line">  * Current DC: controller0 (version 2.0.3-5.el8_2.1-4b1f869f0f) - partition with quorum</span><br><span class="line">  * Last updated: Tue May  6 13:33:04 2025</span><br><span class="line">  * Last change:  Mon May  5 02:29:30 2025 by root via crm_resource on controller0</span><br><span class="line">  * 5 nodes configured</span><br><span class="line">  * 22 resource instances configured</span><br><span class="line"></span><br><span class="line">Node List:</span><br><span class="line">  * Online: [ controller0 ]</span><br><span class="line">  * GuestOnline: [ galera-bundle-0@controller0 ovn-dbs-bundle-0@controller0 rabbitmq-bundle-0@controller0 redis-bundle-0@controller0 ]</span><br><span class="line"></span><br><span class="line">Full List of Resources:</span><br><span class="line">  * Container bundle: galera-bundle [cluster.common.tag/gls-dle-dev-osp16-osp16_containers-openstack-mariadb:pcmklatest]:</span><br><span class="line">    * galera-bundle-0	(ocf::heartbeat:galera):	Master controller0</span><br><span class="line">  * Container bundle: rabbitmq-bundle [cluster.common.tag/gls-dle-dev-osp16-osp16_containers-openstack-rabbitmq:pcmklatest]:</span><br><span class="line">    * rabbitmq-bundle-0	(ocf::heartbeat:rabbitmq-cluster):	Started controller0</span><br><span class="line">  * Container bundle: redis-bundle [cluster.common.tag/gls-dle-dev-osp16-osp16_containers-openstack-redis:pcmklatest]:</span><br><span class="line">    * redis-bundle-0	(ocf::heartbeat:redis):	Master controller0</span><br><span class="line">  * ip-172.25.249.50	(ocf::heartbeat:IPaddr2):	Started controller0</span><br><span class="line">  * ip-172.25.250.50	(ocf::heartbeat:IPaddr2):	Started controller0</span><br><span class="line">  * ip-172.24.1.51	(ocf::heartbeat:IPaddr2):	Started controller0</span><br><span class="line">  * ip-172.24.1.50	(ocf::heartbeat:IPaddr2):	Started controller0</span><br><span class="line">  * ip-172.24.3.50	(ocf::heartbeat:IPaddr2):	Started controller0</span><br><span class="line">  * ip-172.24.4.50	(ocf::heartbeat:IPaddr2):	Started controller0</span><br><span class="line">  * Container bundle: haproxy-bundle [cluster.common.tag/gls-dle-dev-osp16-osp16_containers-openstack-haproxy:pcmklatest]:</span><br><span class="line">    * haproxy-bundle-podman-0	(ocf::heartbeat:podman):	Started controller0</span><br><span class="line">  * Container bundle: ovn-dbs-bundle [cluster.common.tag/gls-dle-dev-osp16-osp16_containers-openstack-ovn-northd:pcmklatest]:</span><br><span class="line">    * ovn-dbs-bundle-0	(ocf::ovn:ovndb-servers):	Master controller0</span><br><span class="line">  * ip-172.24.1.52	(ocf::heartbeat:IPaddr2):	Started controller0</span><br><span class="line">  * Container bundle: openstack-cinder-volume [cluster.common.tag/gls-dle-dev-osp16-osp16_containers-openstack-cinder-volume:pcmklatest]:</span><br><span class="line">    * openstack-cinder-volume-podman-0	(ocf::heartbeat:podman):	Started controller0</span><br><span class="line">  * Container bundle: openstack-manila-share [cluster.common.tag/gls-dle-dev-osp16-osp16_containers-openstack-manila-share:pcmklatest]:</span><br><span class="line">    * openstack-manila-share-podman-0	(ocf::heartbeat:podman):	Started controller0</span><br><span class="line"></span><br><span class="line">Daemon Status:</span><br><span class="line">  corosync: active/enabled</span><br><span class="line">  pacemaker: active/enabled</span><br><span class="line">  pcsd: active/enabled</span><br></pre></td></tr></table></figure>

<h2 id="Accessing-Services-on-the-Overloud"><a href="#Accessing-Services-on-the-Overloud" class="headerlink" title="Accessing Services on the Overloud"></a>Accessing Services on the Overloud</h2><p>When the overcloud is first installed, the procedure creates the <code>overcloudrc</code> identity environment file under the stackrc user’s home directory with the admin credentials to access<br>the overcloud.</p>
<ul>
<li><p>stackrc</p>
<p>It will be created automatically when deploy the undercloud which contains the environment variables in the undercloud.</p>
<p>It could be used to deploy the overcloud.</p>
</li>
<li><p>overcloudrc</p>
<p>After the overcloud was deployed, it will be generated by <code>TripleO</code>.</p>
<p>It is the token&#x2F;authentication file to access the overcloud.</p>
<p>We could check and manage the service on overcloud by CLI command with it.</p>
</li>
</ul>
<h3 id="Switch-to-overcloud-environment-variables"><a href="#Switch-to-overcloud-environment-variables" class="headerlink" title="Switch to overcloud environment variables"></a>Switch to overcloud environment variables</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># Check all environment variables on the overcloud</span><br><span class="line">(overcloud) [stack@director ~]$ env | grep ^OS_*</span><br><span class="line">OS_IMAGE_API_VERSION=2</span><br><span class="line">OS_AUTH_URL=http://172.25.250.50:5000</span><br><span class="line">OS_CLOUDNAME=overcloud</span><br><span class="line">OS_REGION_NAME=regionOne</span><br><span class="line">OS_PROJECT_NAME=admin</span><br><span class="line">OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line">OS_USER_DOMAIN_NAME=Default</span><br><span class="line">OS_IDENTITY_API_VERSION=3</span><br><span class="line">OS_AUTH_TYPE=password</span><br><span class="line">OS_NO_CACHE=True</span><br><span class="line">OS_COMPUTE_API_VERSION=2.latest</span><br><span class="line">OS_PASSWORD=redhat</span><br><span class="line">OS_USERNAME=admin</span><br><span class="line">OS_VOLUME_API_VERSION=3</span><br><span class="line"></span><br><span class="line"># Check all service on the overcloud</span><br><span class="line">(overcloud) [stack@director ~]$ openstack service list</span><br><span class="line">+----------------------------------+-----------+----------------+</span><br><span class="line">| ID                               | Name      | Type           |</span><br><span class="line">+----------------------------------+-----------+----------------+</span><br><span class="line">| 0932e03c896a4e73b905b81a0e4e8b02 | cinderv2  | volumev2       |</span><br><span class="line">| 1b5a14e5ff2d4d988dcbb7d1a31aa257 | panko     | event          |</span><br><span class="line">| 1e50893246094c05b0b8b5028efa65d6 | heat      | orchestration  |</span><br><span class="line">| 20ee8664c18146639e207d1dd833066b | heat-cfn  | cloudformation |</span><br><span class="line">| 2ed07d8f7afd4126b279bd273d029962 | gnocchi   | metric         |</span><br><span class="line">| 31442049b55040d5bb52589e0fd1b31f | nova      | compute        |</span><br><span class="line">| 446c6d0b77a74d05a491393c8d4cc106 | keystone  | identity       |</span><br><span class="line">| 76870267b75a4d0bb70772f586730659 | neutron   | network        |</span><br><span class="line">| 8413046b29f44285a772a8bbd172dbd8 | manilav2  | sharev2        |</span><br><span class="line">| bb7a5e08aad345a489ce0207684ae402 | swift     | object-store   |</span><br><span class="line">| c970fbfbc71a49008760c6d9a6f3ee91 | aodh      | alarming       |</span><br><span class="line">| cc386f44375343d19e1fc78e8e78db35 | cinderv3  | volumev3       |</span><br><span class="line">| cddaafd6d76b424b946a8fdb47a8ed12 | manila    | share          |</span><br><span class="line">| d799151c504541edacd68a08324d37c0 | glance    | image          |</span><br><span class="line">| e15d67325321405b854447a92bfe866f | octavia   | load-balancer  |</span><br><span class="line">| f8ebce21244748c09b20df6e9c939b73 | placement | placement      |</span><br><span class="line">+----------------------------------+-----------+----------------+</span><br></pre></td></tr></table></figure>

<h3 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h3><p>Check the allocated VLAN.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">[heat-admin@controller0 ~]$ sudo ovs-vsctl show</span><br><span class="line">da52b817-899b-459f-b486-b529fcbd9275</span><br><span class="line">    Bridge br-prov2</span><br><span class="line">        fail_mode: standalone</span><br><span class="line">        Port eth4</span><br><span class="line">            Interface eth4</span><br><span class="line">        Port br-prov2</span><br><span class="line">            Interface br-prov2</span><br><span class="line">                type: internal</span><br><span class="line">    Bridge br-int</span><br><span class="line">        Port br-int</span><br><span class="line">            Interface br-int</span><br><span class="line">                type: internal</span><br><span class="line">        Port o-hm0</span><br><span class="line">            Interface o-hm0</span><br><span class="line">                type: internal</span><br><span class="line">        Port patch-br-int-to-provnet-275c889d-ef54-4a38-88ff-a7cedee11506</span><br><span class="line">            Interface patch-br-int-to-provnet-275c889d-ef54-4a38-88ff-a7cedee11506</span><br><span class="line">                type: patch</span><br><span class="line">                options: &#123;peer=patch-provnet-275c889d-ef54-4a38-88ff-a7cedee11506-to-br-int&#125;</span><br><span class="line">        Port ovn-8e0b99-0</span><br><span class="line">            Interface ovn-8e0b99-0</span><br><span class="line">                type: geneve</span><br><span class="line">                options: &#123;csum=&quot;true&quot;, key=flow, remote_ip=&quot;172.24.2.2&quot;&#125;</span><br><span class="line">        Port ovn-3f678a-0</span><br><span class="line">            Interface ovn-3f678a-0</span><br><span class="line">                type: geneve</span><br><span class="line">                options: &#123;csum=&quot;true&quot;, key=flow, remote_ip=&quot;172.24.2.6&quot;&#125;</span><br><span class="line">        Port ovn-b8bd46-0</span><br><span class="line">            Interface ovn-b8bd46-0</span><br><span class="line">                type: geneve</span><br><span class="line">                options: &#123;csum=&quot;true&quot;, key=flow, remote_ip=&quot;172.24.2.12&quot;&#125;</span><br><span class="line">    Bridge br-ex</span><br><span class="line">        fail_mode: standalone</span><br><span class="line">        Port br-ex</span><br><span class="line">            Interface br-ex</span><br><span class="line">                type: internal</span><br><span class="line">        Port patch-provnet-275c889d-ef54-4a38-88ff-a7cedee11506-to-br-int</span><br><span class="line">            Interface patch-provnet-275c889d-ef54-4a38-88ff-a7cedee11506-to-br-int</span><br><span class="line">                type: patch</span><br><span class="line">                options: &#123;peer=patch-br-int-to-provnet-275c889d-ef54-4a38-88ff-a7cedee11506&#125;</span><br><span class="line">        Port eth2</span><br><span class="line">            Interface eth2</span><br><span class="line">    Bridge br-prov1</span><br><span class="line">        fail_mode: standalone</span><br><span class="line">        Port eth3</span><br><span class="line">            Interface eth3</span><br><span class="line">        Port br-prov1</span><br><span class="line">            Interface br-prov1</span><br><span class="line">                type: internal</span><br><span class="line">    Bridge br-trunk</span><br><span class="line">        fail_mode: standalone</span><br><span class="line">        Port vlan40</span><br><span class="line">            tag: 40</span><br><span class="line">            Interface vlan40</span><br><span class="line">                type: internal</span><br><span class="line">        Port eth1</span><br><span class="line">            Interface eth1</span><br><span class="line">        Port vlan20</span><br><span class="line">            tag: 20</span><br><span class="line">            Interface vlan20</span><br><span class="line">                type: internal</span><br><span class="line">        Port vlan30</span><br><span class="line">            tag: 30</span><br><span class="line">            Interface vlan30</span><br><span class="line">                type: internal</span><br><span class="line">        Port vlan50</span><br><span class="line">            tag: 50</span><br><span class="line">            Interface vlan50</span><br><span class="line">                type: internal</span><br><span class="line">        Port br-trunk</span><br><span class="line">            Interface br-trunk</span><br><span class="line">                type: internal</span><br><span class="line">        Port vlan10</span><br><span class="line">            tag: 10</span><br><span class="line">            Interface vlan10</span><br><span class="line">                type: internal</span><br><span class="line">    ovs_version: &quot;2.13.0&quot;</span><br></pre></td></tr></table></figure>

<p>Check the ip address.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[heat-admin@controller0 ~]$ ip --br a</span><br><span class="line">lo               UNKNOWN        127.0.0.1/8 ::1/128 </span><br><span class="line">eth0             UP             172.25.249.56/24 172.25.249.50/32 fe80::5054:ff:fe00:f901/64 </span><br><span class="line">eth1             UP             fe80::5054:ff:fe01:1/64 </span><br><span class="line">eth2             UP             fe80::5054:ff:fe02:fa01/64 </span><br><span class="line">eth3             UP             fe80::5054:ff:fe03:1/64 </span><br><span class="line">eth4             UP             fe80::5054:ff:fe04:1/64 </span><br><span class="line">ovs-system       DOWN           </span><br><span class="line">br-prov1         UNKNOWN        fe80::5054:ff:fe03:1/64 </span><br><span class="line">genev_sys_6081   UNKNOWN        fe80::3c78:cbff:feee:3bf0/64 </span><br><span class="line">o-hm0            UNKNOWN        172.23.3.42/16 fe80::f816:3eff:fecd:dfd4/64 </span><br><span class="line">br-int           UNKNOWN        fe80::40e:d7ff:fe34:2944/64 </span><br><span class="line">br-ex            UNKNOWN        172.25.250.1/24 172.25.250.50/32 fe80::5054:ff:fe02:fa01/64 </span><br><span class="line">br-prov2         UNKNOWN        fe80::5054:ff:fe04:1/64 </span><br><span class="line">vlan40           UNKNOWN        172.24.4.1/24 172.24.4.50/32 fe80::b4ca:55ff:fe88:4fd4/64 </span><br><span class="line">vlan10           UNKNOWN        172.24.1.1/24 172.24.1.51/32 172.24.1.50/32 172.24.1.52/32 fe80::f45f:9ff:feed:88a4/64 </span><br><span class="line">vlan20           UNKNOWN        172.24.2.1/24 fe80::8cd7:ccff:fe8a:c345/64 </span><br><span class="line">vlan50           UNKNOWN        172.24.5.1/24 fe80::c2c:bcff:fe88:d879/64 </span><br><span class="line">vlan30           UNKNOWN        172.24.3.1/24 172.24.3.50/32 fe80::14aa:e9ff:fe4e:95a2/64 </span><br><span class="line">br-trunk         UNKNOWN        fe80::5054:ff:fe01:1/64 </span><br></pre></td></tr></table></figure>

<p>The <code>eth0</code> interface is the 172.25.249.0<br><code>provisioning</code> network.</p>
<p>The <code>br-trunk</code> is the internal network.</p>
<p>The <code>br-ex bridge</code> is the 172.25.250.0 <code>public</code> network.</p>
<h2 id="Containerized-services"><a href="#Containerized-services" class="headerlink" title="Containerized services"></a>Containerized services</h2><p>As I introduced in the Chapter1, all services are containerized here.</p>
<p>Let’s check all services in podman container.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@controller0 ~]# podman ps --format &quot;table &#123;&#123;.Names&#125;&#125; &#123;&#123;.Status&#125;&#125;&quot;</span><br><span class="line">Names                              Status</span><br><span class="line">openstack-manila-share-podman-0    Up 11 hours ago</span><br><span class="line">openstack-cinder-volume-podman-0   Up 11 hours ago</span><br><span class="line">ovn-dbs-bundle-podman-0            Up 11 hours ago</span><br><span class="line">haproxy-bundle-podman-0            Up 11 hours ago</span><br><span class="line">rabbitmq-bundle-podman-0           Up 11 hours ago</span><br><span class="line">galera-bundle-podman-0             Up 11 hours ago</span><br><span class="line">redis-bundle-podman-0              Up 11 hours ago</span><br><span class="line">ceph-mgr-controller0               Up 11 hours ago</span><br><span class="line">ceph-mon-controller0               Up 11 hours ago</span><br><span class="line">ceph-mds-controller0               Up 11 hours ago</span><br><span class="line">octavia_worker                     Up 11 hours ago</span><br><span class="line">...ommited...</span><br></pre></td></tr></table></figure>

<p>More detailed configuration information could be viewed by <code>inspect</code> command.</p>
<p>E.g.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@controller0 ~]# podman inspect keystone | jq .[].HostConfig.Binds</span><br><span class="line">[</span><br><span class="line">  &quot;/etc/pki/tls/cert.pem:/etc/pki/tls/cert.pem:ro,rprivate,rbind&quot;,</span><br><span class="line">  &quot;/etc/puppet:/etc/puppet:ro,rprivate,rbind&quot;,</span><br><span class="line">  &quot;/etc/pki/ca-trust/extracted:/etc/pki/ca-trust/extracted:ro,rprivate,rbind&quot;,</span><br><span class="line">  &quot;/var/lib/config-data/puppet-generated/keystone:/var/lib/kolla/config_files/src:ro,rprivate,rbind&quot;,</span><br><span class="line">  &quot;/var/log/containers/keystone:/var/log/keystone:rw,rprivate,rbind&quot;,</span><br><span class="line">  &quot;/dev/log:/dev/log:rw,rprivate,nosuid,rbind&quot;,</span><br><span class="line">  &quot;/etc/pki/tls/certs/ca-bundle.crt:/etc/pki/tls/certs/ca-bundle.crt:ro,rprivate,rbind&quot;,</span><br><span class="line">  &quot;/etc/pki/tls/certs/ca-bundle.trust.crt:/etc/pki/tls/certs/ca-bundle.trust.crt:ro,rprivate,rbind&quot;,</span><br><span class="line">  &quot;/var/log/containers/httpd/keystone:/var/log/httpd:rw,rprivate,rbind&quot;,</span><br><span class="line">  &quot;/etc/localtime:/etc/localtime:ro,rprivate,rbind&quot;,</span><br><span class="line">  &quot;/etc/pki/ca-trust/source/anchors:/etc/pki/ca-trust/source/anchors:ro,rprivate,rbind&quot;,</span><br><span class="line">  &quot;/var/lib/kolla/config_files/keystone.json:/var/lib/kolla/config_files/config.json:ro,rprivate,rbind&quot;,</span><br><span class="line">  &quot;/etc/hosts:/etc/hosts:ro,rprivate,rbind&quot;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="Configuration-Management-of-Containerized-Services"><a href="#Configuration-Management-of-Containerized-Services" class="headerlink" title="Configuration Management of Containerized Services"></a>Configuration Management of Containerized Services</h2><blockquote>
<p>Remember to modify the configuration in physical rather than inside the container, because all changes will be reset after restarting the container.</p>
</blockquote>
<ul>
<li><p>Configuration files path</p>
<p><code>/var/log/config-data/puppet-generated/[service_name]/etc/</code></p>
<p>Excepted for using <code>vim</code> command to modify the configuration, <code>crudini</code> also makes sense.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@controller0 puppet-generated]# podman exec -it keystone crudini --get /etc/keystone/keystone.conf DEFAULT debug</span><br><span class="line">False</span><br><span class="line"></span><br><span class="line">[root@controller0 puppet-generated]# crudini --get keystone/etc/keystone/keystone.conf DEFAULT debug</span><br><span class="line">False</span><br><span class="line"></span><br><span class="line">[root@controller0 puppet-generated]# crudini --set keystone/etc/keystone/keystone.conf DEFAULT debug </span><br><span class="line">True</span><br><span class="line"></span><br><span class="line">[root@controller0 puppet-generated]# crudini --get keystone/etc/keystone/keystone.conf DEFAULT debug</span><br><span class="line">True</span><br><span class="line"></span><br><span class="line">[root@controller0 puppet-generated]# podman restart keystone</span><br><span class="line">keystone</span><br><span class="line"></span><br><span class="line">[root@controller0 puppet-generated]# podman exec -it keystone crudini --get /etc/keystone/keystone.conf DEFAULT debug</span><br><span class="line">True</span><br></pre></td></tr></table></figure>
</li>
<li><p>Log files path</p>
<p><code>/var/log/containers/[service_name]</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@controller0 containers]# pwd</span><br><span class="line">/var/log/containers</span><br><span class="line">[root@controller0 containers]# ls</span><br><span class="line">aodh        glance   heat     keystone   mysql    octavia      placement  stdouts</span><br><span class="line">ceilometer  gnocchi  horizon  manila     neutron  openvswitch  rabbitmq   swift</span><br><span class="line">cinder      haproxy  httpd    memcached  nova     panko        redis</span><br><span class="line">[root@controller0 containers]# cd keystone/</span><br><span class="line">[root@controller0 keystone]# ls</span><br><span class="line">keystone.log        keystone.log.11.gz  keystone.log.14.gz  keystone.log.4.gz  keystone.log.7.gz</span><br><span class="line">keystone.log.1      keystone.log.12.gz  keystone.log.2.gz   keystone.log.5.gz  keystone.log.8.gz</span><br><span class="line">keystone.log.10.gz  keystone.log.13.gz  keystone.log.3.gz   keystone.log.6.gz  keystone.log.9.gz</span><br></pre></td></tr></table></figure>

<p>Containers also retain memory-based log structures that store the container’s console STDOUT activity.(<code>/var/log/containers/stdouts</code>) Use podman logs service to view the container’s console activity, for example <code>podman logs</code> keystone.</p>
</li>
</ul>
<h2 id="Managing-Storage-Nodes"><a href="#Managing-Storage-Nodes" class="headerlink" title="Managing Storage Nodes"></a>Managing Storage Nodes</h2><h3 id="Check-the-services-on-the-Controller-node"><a href="#Check-the-services-on-the-Controller-node" class="headerlink" title="Check the services on the Controller node"></a>Check the services on the Controller node</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@controller0 stdouts]# podman ps --format &quot;&#123;&#123;.Names&#125;&#125;&quot; | grep ceph</span><br><span class="line">ceph-mgr-controller0</span><br><span class="line">ceph-mon-controller0</span><br><span class="line">ceph-mds-controller0</span><br></pre></td></tr></table></figure>

<p>We obtain three ceph services <code>mgr+mon+mds</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller0 stdouts]# systemctl list-units | grep ceph</span><br><span class="line">ceph-mds@controller0.service                                                                                                         loaded active     running         Ceph MDS                                                                                                                    </span><br><span class="line">ceph-mgr@controller0.service                                                                                                         loaded active     running         Ceph Manager                                                                                                                </span><br><span class="line">ceph-mon@controller0.service                                                                                                         loaded active     running         Ceph Monitor                                                                                                                </span><br><span class="line">system-ceph\x2dmds.slice                                                                                                             loaded active     active          system-ceph\x2dmds.slice                                                                                                    </span><br><span class="line">system-ceph\x2dmgr.slice                                                                                                             loaded active     active          system-ceph\x2dmgr.slice                                                                                                    </span><br><span class="line">system-ceph\x2dmon.slice                                                                                                             loaded active     active          system-ceph\x2dmon.slice   </span><br></pre></td></tr></table></figure>

<h3 id="Check-all-storage-pools"><a href="#Check-all-storage-pools" class="headerlink" title="Check all storage pools"></a>Check all storage pools</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@controller0 stdouts]# systemctl status ceph-mon@controller.service</span><br><span class="line">● ceph-mon@controller.service - Ceph Monitor</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/ceph-mon@.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: inactive (dead)</span><br><span class="line"></span><br><span class="line">[root@controller0 stdouts]# podman exec ceph-mon-controller0 ceph osd pool ls</span><br><span class="line">vms</span><br><span class="line">volumes</span><br><span class="line">images</span><br><span class="line">manila_data</span><br><span class="line">manila_metadata</span><br></pre></td></tr></table></figure>

<h3 id="List-all-OSDs"><a href="#List-all-OSDs" class="headerlink" title="List all OSDs"></a>List all OSDs</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@controller0 stdouts]# podman exec ceph-mon-controller0 ceph osd ls</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td></tr></table></figure>

<h3 id="Check-the-health-situation-of-the-ceph-cluster"><a href="#Check-the-health-situation-of-the-ceph-cluster" class="headerlink" title="Check the health situation of the ceph cluster"></a>Check the health situation of the ceph cluster</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@controller0 stdouts]# podman exec ceph-mon-controller0 ceph -s</span><br><span class="line">  cluster:</span><br><span class="line">    id:     96157d2f-395f-4a54-8a19-b6042465100d</span><br><span class="line">    health: HEALTH_OK</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 1 daemons, quorum controller0 (age 11h)</span><br><span class="line">    mgr: controller0(active, since 11h)</span><br><span class="line">    mds: cephfs:1 &#123;0=controller0=up:active&#125;</span><br><span class="line">    osd: 6 osds: 6 up (since 11h), 6 in (since 4y)</span><br><span class="line"> </span><br><span class="line">  task status:</span><br><span class="line">    scrub status:</span><br><span class="line">        mds.controller0: idle</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   5 pools, 320 pgs</span><br><span class="line">    objects: 2.62k objects, 19 GiB</span><br><span class="line">    usage:   25 GiB used, 95 GiB / 120 GiB avail</span><br><span class="line">    pgs:     320 active+clean</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.sunhaoyang.net">Haoyang Sun</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.sunhaoyang.net/Cloud/OpenStack/Introducing-Overcloud/index.html">https://blog.sunhaoyang.net/Cloud/OpenStack/Introducing-Overcloud/index.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">This article is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License. Please attribute the original author and source when sharing.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/OpenStack/">OpenStack</a></div><div class="post-share"><div class="social-share" data-image="https://blog.sunhaoyang.net/images/OpenStack.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="/pluginsSrc/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>Buy Me a Coffee</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://blog.sunhaoyang.net/images/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="https://blog.sunhaoyang.net/images/wechat.jpg" alt="Wechat"/></a><div class="post-qr-code-desc">Wechat</div></li><li class="reward-item"><a href="https://blog.sunhaoyang.net/images/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="https://blog.sunhaoyang.net/images/alipay.jpg" alt="Alipay"/></a><div class="post-qr-code-desc">Alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/Cloud/OpenStack/Openstack-Deployment-Overview/index.html" title="Openstack Deployment Series Chapter0:Overview"><img class="cover" src="https://blog.sunhaoyang.net/images/OpenStack.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Openstack Deployment Series Chapter0:Overview</div></div><div class="info-2"><div class="info-item-1">This deployment uses a fully manual approach, with the aim of helping everyone understand the deployment details and how the components work together.</div></div></div></a><a class="pagination-related" href="/Cloud/OpenStack/Introducing-Undercloud/index.html" title="OpenStack Series Chapter2:Introducing Undercloud"><img class="cover" src="https://blog.sunhaoyang.net/images/OpenStack.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">OpenStack Series Chapter2:Introducing Undercloud</div></div><div class="info-2"><div class="info-item-1">Let's understand the core Red Hat OpenStack components, manage undercloud services, and view the undercloud structure in this Chapter.</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/Cloud/OpenStack/Openstack-Deployment-Overview/index.html" title="Openstack Deployment Series Chapter0:Overview"><img class="cover" src="https://blog.sunhaoyang.net/images/OpenStack.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-06</div><div class="info-item-2">Openstack Deployment Series Chapter0:Overview</div></div><div class="info-2"><div class="info-item-1">This deployment uses a fully manual approach, with the aim of helping everyone understand the deployment details and how the components work together.</div></div></div></a><a class="pagination-related" href="/Cloud/OpenStack/Introducing-Undercloud/index.html" title="OpenStack Series Chapter2:Introducing Undercloud"><img class="cover" src="https://blog.sunhaoyang.net/images/OpenStack.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-30</div><div class="info-item-2">OpenStack Series Chapter2:Introducing Undercloud</div></div><div class="info-2"><div class="info-item-1">Let's understand the core Red Hat OpenStack components, manage undercloud services, and view the undercloud structure in this Chapter.</div></div></div></a><a class="pagination-related" href="/Cloud/OpenStack/Introducing-Containerized-Services/index.html" title="OpenStack Series Chapter1:Introducing Containerized Services"><img class="cover" src="https://blog.sunhaoyang.net/images/OpenStack.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-29</div><div class="info-item-2">OpenStack Series Chapter1:Introducing Containerized Services</div></div><div class="info-2"><div class="info-item-1">This article provides a detailed introduction to how the main services of OpenStack run in containers through TripleO. It covers the relevant container commands in detail, as well as how to manage container services using systemd.</div></div></div></a><a class="pagination-related" href="/Cloud/OpenStack/Creating-and-Deleting-VMs-instaces(2)/index.html" title="OpenStack Series Chapter0: Creating and Deleting VMs instaces(2)"><img class="cover" src="https://blog.sunhaoyang.net/images/OpenStack.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-14</div><div class="info-item-2">OpenStack Series Chapter0: Creating and Deleting VMs instaces(2)</div></div><div class="info-2"><div class="info-item-1">This article mainly introduces how to create and delete the VMs instance in openstack by using CLI in terminal.</div></div></div></a><a class="pagination-related" href="/Cloud/OpenStack/Creating-and-Deleting-VMs-instaces(1)/index.html" title="OpenStack Series Chapter0: Creating and Deleting VMs instaces(1)"><img class="cover" src="https://blog.sunhaoyang.net/images/OpenStack.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-12</div><div class="info-item-2">OpenStack Series Chapter0: Creating and Deleting VMs instaces(1)</div></div><div class="info-2"><div class="info-item-1">This article mainly introduces how to create and delete the VMs instance in openstack by clicking on the mangement dashboard.</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comments</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://blog.sunhaoyang.net/images/myphoto.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Haoyang Sun</div><div class="author-info-description">DevOps Engineer, Cloud-native Engineer, Open-source technology enthusiast</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">36</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content"><div class="center-content" style="text-align: center;">
    <p>My blog is now live!</p>
    <p>Hello everyone! Thank you for visiting my blog!</p>
    <p>Here, I will share my thoughts and reflections on various technologies and aspects of life.</p>
    <p>Please stay tuned for updates!:)</p>
    <p>If you’re interested in discussing any topic with me, feel free to leave a comment or reach out through the contact information provided below.</p>
    <p>Email: Flash_shy@163.com</p>
    <p>QQ ID: 1135300457</p>
    <p>Wechat ID: Flash_sunhy</p>
</div>
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Overview"><span class="toc-number">1.</span> <span class="toc-text">Overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Deployment-template"><span class="toc-number">2.</span> <span class="toc-text">The Deployment template</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Check-all-default-roles"><span class="toc-number">2.1.</span> <span class="toc-text">Check all default roles</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Check-all-deployed-roles"><span class="toc-number">2.2.</span> <span class="toc-text">Check all deployed roles</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Components-and-Services"><span class="toc-number">3.</span> <span class="toc-text">Components and Services</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Core-Services"><span class="toc-number">3.1.</span> <span class="toc-text">Core Services</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Discretionary-and-Operational-OpenStack-Services"><span class="toc-number">3.2.</span> <span class="toc-text">Discretionary and Operational OpenStack Services</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Managing-the-Overcloud"><span class="toc-number">4.</span> <span class="toc-text">Managing the Overcloud</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Listing-all-Overcloud-nodes"><span class="toc-number">4.1.</span> <span class="toc-text">Listing all Overcloud nodes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#High-Availability"><span class="toc-number">4.2.</span> <span class="toc-text">High Availability</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Accessing-Services-on-the-Overloud"><span class="toc-number">5.</span> <span class="toc-text">Accessing Services on the Overloud</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Switch-to-overcloud-environment-variables"><span class="toc-number">5.1.</span> <span class="toc-text">Switch to overcloud environment variables</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Network"><span class="toc-number">5.2.</span> <span class="toc-text">Network</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Containerized-services"><span class="toc-number">6.</span> <span class="toc-text">Containerized services</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configuration-Management-of-Containerized-Services"><span class="toc-number">7.</span> <span class="toc-text">Configuration Management of Containerized Services</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Managing-Storage-Nodes"><span class="toc-number">8.</span> <span class="toc-text">Managing Storage Nodes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Check-the-services-on-the-Controller-node"><span class="toc-number">8.1.</span> <span class="toc-text">Check the services on the Controller node</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Check-all-storage-pools"><span class="toc-number">8.2.</span> <span class="toc-text">Check all storage pools</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#List-all-OSDs"><span class="toc-number">8.3.</span> <span class="toc-text">List all OSDs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Check-the-health-situation-of-the-ceph-cluster"><span class="toc-number">8.4.</span> <span class="toc-text">Check the health situation of the ceph cluster</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Linux/Mount/cifs-mount-attention/index.html" title="cifs mount attention"><img src="https://blog.sunhaoyang.net/images/Mount.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="cifs mount attention"/></a><div class="content"><a class="title" href="/Linux/Mount/cifs-mount-attention/index.html" title="cifs mount attention">cifs mount attention</a><time datetime="2025-05-07T05:12:46.000Z" title="Created 2025-05-07 13:12:46">2025-05-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Cloud/OpenStack/Openstack-Deployment-Overview/index.html" title="Openstack Deployment Series Chapter0:Overview"><img src="https://blog.sunhaoyang.net/images/OpenStack.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Openstack Deployment Series Chapter0:Overview"/></a><div class="content"><a class="title" href="/Cloud/OpenStack/Openstack-Deployment-Overview/index.html" title="Openstack Deployment Series Chapter0:Overview">Openstack Deployment Series Chapter0:Overview</a><time datetime="2025-05-06T15:25:18.000Z" title="Created 2025-05-06 23:25:18">2025-05-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Cloud/OpenStack/Introducing-Overcloud/index.html" title="OpenStack Series Chapter3:Introducing Overcloud"><img src="https://blog.sunhaoyang.net/images/OpenStack.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OpenStack Series Chapter3:Introducing Overcloud"/></a><div class="content"><a class="title" href="/Cloud/OpenStack/Introducing-Overcloud/index.html" title="OpenStack Series Chapter3:Introducing Overcloud">OpenStack Series Chapter3:Introducing Overcloud</a><time datetime="2025-05-06T12:45:13.000Z" title="Created 2025-05-06 20:45:13">2025-05-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Cloud/OpenStack/Introducing-Undercloud/index.html" title="OpenStack Series Chapter2:Introducing Undercloud"><img src="https://blog.sunhaoyang.net/images/OpenStack.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OpenStack Series Chapter2:Introducing Undercloud"/></a><div class="content"><a class="title" href="/Cloud/OpenStack/Introducing-Undercloud/index.html" title="OpenStack Series Chapter2:Introducing Undercloud">OpenStack Series Chapter2:Introducing Undercloud</a><time datetime="2025-04-30T14:24:57.000Z" title="Created 2025-04-30 22:24:57">2025-04-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Database/MySQL/Introduction/index.html" title="MySQL Series Chapter0: Introduction"><img src="https://blog.sunhaoyang.net/images/MySQL.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL Series Chapter0: Introduction"/></a><div class="content"><a class="title" href="/Database/MySQL/Introduction/index.html" title="MySQL Series Chapter0: Introduction">MySQL Series Chapter0: Introduction</a><time datetime="2025-04-29T16:23:17.000Z" title="Created 2025-04-30 00:23:17">2025-04-30</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://blog.sunhaoyang.net/images/footer_background.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By Haoyang Sun</div><div class="footer_custom_text"><a href="https://beian.mps.gov.cn/#/query/webSearch" target="_blank">
  <img src="https://blog.sunhaoyang.net/images/gonganbeian.png" alt="公安备案" style="vertical-align:middle; width:16px; heigh:16px;"> 辽公网安备21029602001011号
</a>
<a href="https://beian.miit.gov.cn/" rel="noreferrer" target="_blank">
  <img src="https://blog.sunhaoyang.net/images/icpbeian.png" alt="ICP备案" style="vertical-align:middle; width:16px; height:16px;"> 辽ICP备2025048274号-1
</a>
</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll to Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.sunhaoyang.net/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo.sunhaoyang.net/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    GLOBAL_CONFIG_SITE.isPost && getCount()

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('/pluginsSrc/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script>window.newestComments = {
  changeContent: content => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[Image]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[Link]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[Code]') // replace code
    content = content.replace(/<code>.*?<\/code>/gi, '[Code]') // replace code      
    content = content.replace(/<[^>]+>/g, "") // remove html tag

    if (content.length > 150) {
      content = content.substring(0, 150) + '...'
    }
    return content
  },

  generateHtml: (array, ele) => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class="aside-list-item">'

        if (true && array[i].avatar) {
          const imgAttr = 'src'
          result += `<a href="${array[i].url}" class="thumbnail"><img ${imgAttr}="${array[i].avatar}" alt="${array[i].nick}"></a>`
        }

        result += `<div class="content">
        <a class="comment" href="${array[i].url}" title="${array[i].content}">${array[i].content}</a>
        <div class="name"><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += 'No comments'
    }

    ele.innerHTML = result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh(ele)
  },

  newestCommentInit: (name, getComment) => {
    const $dom = document.querySelector('#card-newest-comments .aside-list')
    if ($dom) {
      const data = btf.saveToLocal.get(name)
      if (data) {
        newestComments.generateHtml(JSON.parse(data), $dom)
      } else {
        getComment($dom)
      }
    }
  },

  run: (name, getComment) => {
    newestComments.newestCommentInit(name, getComment)
    btf.addGlobalFn('pjaxComplete', () => newestComments.newestCommentInit(name, getComment), name)
  }
}</script><script>window.addEventListener('load', () => {
  const keyName = 'twikoo-newest-comments'
  const { changeContent, generateHtml, run } = window.newestComments

  const getComment = ele => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.sunhaoyang.net/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(res => {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        btf.saveToLocal.set(keyName, JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray, ele)
      }).catch(err => {
        console.error(err)
        ele.textContent= "Unable to retrieve comments, please check the configuration"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      btf.getScript('/pluginsSrc/twikoo/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  run(keyName, getComment)
})</script><div class="aplayer no-destroy" data-id="7613104556" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><script defer="defer" id="fluttering_ribbon" mobile="true" src="/pluginsSrc/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="/pluginsSrc/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="/pluginsSrc/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="/pluginsSrc/aplayer/dist/APlayer.min.js"></script><script src="/pluginsSrc/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="/pluginsSrc/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404.html')
    }
  })
})()</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>